////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//
//  Copyright (C) 2008 Quantron Systems LLC.
//  All Rights Reserved.
//
//  This file is part of the Private project.
//  For conditions of distribution and use,
//  please contact sales@quantron-systems.com
//
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
// @see https://github.com/flatiron/winston/
// @see https://github.com/lemonde/winston-kibana

import _ from 'lodash';
import winston from 'winston';
import settings from './settings';

////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
const transports = [
    new winston.transports.Console({
        json: false,
        timestamp: true,
        handleExceptions: false,
        colorize: true,
        level: 'silly'
    })
];

////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
const logstash = settings('LOGSTASH');
if(!_.isEmpty(logstash)) {
    // eslint-disable-next-line import/no-unresolved
    require('winston-logstash');
    transports.push(
        new winston.transports.Logstash({
            port: logstash.PORT,
            node_name: logstash.NAME,
            host: logstash.HOST,
            level: logstash.LEVEL || 'silly'
        })
    );
}

////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
const logger = new winston.Logger({
    transports,
    exitOnError: true
});

////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
export default logger;

////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
